<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="/style.css">
        <link rel="icon" type="image/png" href="/favicon.png"/>
        <title>Waterford Model UN</title>
        <script src="/lib/Sortable.js"></script>
        <script src="/lib/jquery.js"></script>
        <script src="/lib/jquery-sortable.js"></script>
    </head>
    <body>
        <div id="committeeNameContainer">
            <input id="committeeName" type="text" placeholder="Committee topic/agenda..."></input>
        </div>
        <div id="topbar" class="outlineddiv">
            <div id="peopleeditcontainer">
                <div id="peopleedit" class="outlineddiv">
                    <div id="leftDelegateBox">
                        <p><span id="numberOfDelegates">0 Delegates</span></p>
                        <button id="editdelegatelistbutton">Edit List<span class="keyboardShortcut"> (d)</span></button>
                        <button id="takeAttendanceButton">Attendance<span class="keyboardShortcut"> (a)</span></button>
                    </div>
                    <div class="middleLine"></div>
                    <div id="rightDelegateBox">
                        <p style="text-align: center;">Simple majority: <span id="simpleMajorityLabel">0/0</span></p>
                        <p style="text-align: center;">Two thirds: <span id="twoThirdsLabel">0/0</span></p>
                    </div>
                </div>
            </div>
            <div id="newmotions" class="outlineddiv"> <!-- Wow this turned out a lot worse than I could have hoped -->
                <div id="newMotionLabel"><h1>New Motion</h1></div>
                <!--<button id="setAgenda">Set Agenda</button>-->
                <!-- <div id="newmotionsinner"> -->
                    <div id="newmotionsinnerinner">
                        <button id="newSpeakersList" class="outlineddiv">Speakers List<span class="keyboardShortcut"> (s)</span></button>
                        <button id="newMod" class="outlineddiv">Moderated Caucus<span class="keyboardShortcut"> (m)</span></button>
                        <button id="newUnmod" class="outlineddiv">Unmoderated Caucus<span class="keyboardShortcut"> (u)</span></button>
                        <button id="newRoundRobin" class="outlineddiv">Round Robin<span class="keyboardShortcut"> (r)</span></button>
                        <button id="newIntroduce" class="outlineddiv">Introduce Papers<span class="keyboardShortcut"> (i)</span></button>
                    </div>
                <!-- </div> -->
            </div>
            <div id="exitCurrentMotion" class="outlineddiv" style="vertical-align: middle;display:none;">
                <button style="width: 100%;height:100%;border-radius: 15px;" onclick="endCurrentMotion()">End Current Motion</button>
            </div>
            
            <div id="cloudStuffInner" class="outlineddiv">
                <div></div>
                <button id="saveToCloudButton">Save/Load</button>
                <!-- <button id="loadFromCloudButton">Load from Cloud</button> -->
                <button id="logoContainer">Notes</button>
                <button id="startJCC">Join JCC</button>
                <button id="jccInfo" style="display:none">JCC Info</button>
            </div>
        </div>
        <div id="bottomarea" style="display: none;">
            <div id="leftbottomarea" class="bottomarea">
                <div id="motiondisplays">
                    <h1 id="firstMotionPrompt" style="width:100%;text-align:center;">Make a motion to get started</h1>
                </div>
            </div>
            <div id="rightbottomarea" class="bottomarea">
                <div id="passedMotionDetails" class="outlineddiv">
                    <div>
                        <h2 id="passedMotionName">Uh oh</h1>
                        <br>
                        <h1 id="passedMotionTopic">You fucked up</h2>
                        <div id="oneLargeTimerContainer">
                            <p id="oneLargeTimer">0:00</p>
                            <p id="modPlacementP"><span id="modDelegateIndexSpan">1</span>/<span id="modDelegateTotal">5</span></p><br><br>
                            <div id="timerControlsContainer">
                                <button id="toggleMotionButton" onclick="toggleTimer()">Start</button>
                                <button id="restartMotionTimerButton">Restart</button>
                                <button id="yieldTimeButton">Yield</button>
                                <!-- <button id="previousSpeakerButton">Previous</button> -->
                            </div>
                        </div>
                    </div>
                    <div id="chosenCountriesContainer">
                        <p style="font-size: 70%;"><i>(Drag to reorder)</i></p>
                        <div class="outlineddiv" id="chosenCountriesForTimer">
                            <div class="outlineddiv">EEE</div>
                            <div class="outlineddiv">CCC</div>
                            <div class="outlineddiv">DDD</div>
                            <div class="outlineddiv">AAA</div>
                        </div>
                        <p id="numberOfAddedCountriesLabel"><span id="numberOfAddedCountriesSpan">0</span>/<span id="maxNumberOfAddedCountriesSpan">10</span></p>
                    </div>
                    <div id="jccPassPaperContainer">
                        <h2>Pass Papers</h2>
                        <input id="passedPaperNameInput" type="text">
                        <button id="passedPaperButton">Pass</button>
                    </div>
                </div>
                <div id="passedMotionCountryChooser" class="outlineddiv">
                    
                </div>
            </div>
        </div>
        <div id="popupPage">
            <div id="editDelegateList" class="outlineddiv largePopup">
                <div id="searchbarContainer">
                    <input type="text" id="delegateListSearch" spellcheck="false" placeholder="Search for a country...">
                    <button onclick="$('#delegateListSearch').val('');refreshDelegateListSearch();" style="padding: 2px;aspect-ratio: 1;">X</button>
                </div>
                <div id="delegateListSearchBottomContainer">
                    <div id="normalDelegateList">
                        <h2 style="text-align: center;">Normal UN Delegates</h2>
                    </div>
                    <div id="customDelegateList">
                        <h2 style="text-align: center;">Custom UN Delegates</h2>
                    </div>
                    <div id="newDelegate" style="display: flex;width:100%;">
                        <input type="text" id="newDelegateInput" maxlength="100" placeholder="New delegate name..." style="width:80%;margin:10px;">
                        <button id="newDelegateSubmit" style="width:20%;margin:10px;">New Delegate</button>
                    </div>
                </div>
            </div>
            <div id="attendanceList" class="outlineddiv largePopup">
                <h3>Attendance</h3>
                <button onmousedown="
                    document.getElementById('attendanceListOfCountries').childNodes.forEach((el) => {
                        if(typeof el.childNodes['3'] != 'undefined') {
                            el.childNodes[3].click();
                        }
                    });
                " id="allAbsentButton">All absent</button>
                <button id="allPresentButton">All present</button>
                <button onmousedown="
                document.getElementById('attendanceListOfCountries').childNodes.forEach((el) => {
                    if(typeof el.childNodes['3'] != 'undefined') {
                        el.childNodes[7].click();
                    }
                });
                " id="allPrVButton">All present and voting</button>
                <br><br>
                <div id="attendanceListOfCountries">

                </div>
            </div>
            <div id="newModPopup" class="bottomMarginChildren outlineddiv">
                <h3>Moderated Caucus</h3>
                Topic: <input type="text" id="newModTopic" style="width:50%;" value="">
                <br>
                Total duration: <input type="text" id="newModPopupDuration" value="5:00" class="largeTextInput">
                <br>
                Delegate speaking time: <input type="text" id="newModPopupDelegateDuration" value="1:00" class="largeTextInput">
            </div>
            <div id="speakersListPopup" class="bottomMarginChildren outlineddiv">
                <h3>Open the Speakers List</h3>
                <br>
                Number of Speakers: <input type="text" id="speakersListNumDelegates" value="10" class="largeTextInput">
                <br>
                Delegate speaking time: <input type="text" id="speakersListPopupDelegateDuration" value="1:00" class="largeTextInput">
            </div>
            <div id="newUnmodPopup" class="bottomMarginChildren outlineddiv">
                <h3>Unmoderated Caucus</h3>
                Topic: <input type="text" id="newUnmodTopic" style="width:50%;" value="">
                <br>
                Duration: <input type="text" id="newUnmodPopupDuration" value="5:00" class="largeTextInput">
            </div>
            <div id="roundRobinPopup" class="bottomMarginChildren outlineddiv">
                <h3>Round Robin</h3>
                <br>
                Topic: <input type="text" id="roundRobinTopic" value="" class="largeTextInput" style="width: 60%; text-align: left !important;">
                <br>
                Delegate speaking time: <input type="text" id="roundRobinDelegateDuration" value="0:20" class="largeTextInput">
            </div>
            <div id="rollCallVotePopup" class="bottomMarginChildren outlineddiv largePopup">
                <div>
                    <br><br>
                    <h1>Roll Call Vote</h1>
                    <p><span id="rollCallNumVotesNeededToWin"></span> yeas required to pass</p>
                    <p>&#8595;</p>
                </div>
                <div id="rollCallVoteResults" style="height:40px;line-height: 40px;vertical-align: middle;">
                    <div id="yeaRollCallSegment"></div>
                    <div id="abstainRollCallSegment">0 Abstains</div>
                    <div id="nayRollCallSegment"></div>
                </div>
                <div id="rollCallBottomArea">
                    <div id="rollCallCurrentChoice">
                        <h2><span id="rollCallCountryName">United States</span> (<span id="rollCallVoterAttendance">Present</span>)</h2>
                        <div id="rollCallButtonContainer">
                            <button id="rollCallYeaButton">Yea</button>
                            <button id="rollCallNayButton">Nay</button>
                            <button id="rollCallAbstainButton">Abstain</button>
                        </div>
                    </div>
                    <div id="rollCallPastChoices" class="outlineddiv">
                        
                    </div>
                </div>
            </div>
            <div id="saveToTheCloudPopup" class="bottomMarginChildren outlineddiv largePopup">
                <h1>Save/Load State</h1>
                <br>
                ID: <input type="text" id="saveToCloudName" maxlength="64" style="width: 50% !important;text-align: left;">
                <br>
                <button id="saveToCloudSubmit">Save to Cloud</button>
                <button id="loadFromCloudSubmit">Load from Cloud</button>
                <hr style="width: 90%;margin-left: 5%;">
                <h3>Save/Load state from string</h3>
                <button onclick="navigator.clipboard.writeText(JSON.stringify(getStateJSON())); createAlert('Copied.') ">Copy save string</button>
                <!-- Spaghetti code go brrrrr --><button onclick="
                if(!$('#saveLoadInput').val()) { createAlert('No string!'); return; }
                try {
                    var t = JSON.parse($('#saveLoadInput').val());
                    implementStateJSON(t);
                } catch(e) {
                    createAlert('Invalid string!');
                    throw e;
                }
                ">Load save string</button>
                <br>
                <input id="saveLoadInput" type="text" placeholder="Copy and paste the save string here...">
            </div>
            <div id="loadFromTheCloudPopup" class="bottomMarginChildren outlineddiv">
                <h1>Load State From Cloud</h1>
                <br>
                ID: <input type="text" id="loadFromCloudName" maxlength="64" style="width: 50% !important;text-align: left;">
                <br>
                <!-- <button id="loadFromCloudSubmit">Load from Cloud</button> -->
            </div>
            <div id="legalStuffEwww" class="bottomMarginChildren outlineddiv largePopup">
                <h1>Help</h1>
                <br>
                <p>I made this website for my high school's Capstone project (though I have significantly added to it afterwards). It was specifically made for use in my school's club. I intended it to be used as a tool during a conference, not to run every little bit of it.</p>
                <br>
                <p>This website's source code is licensed under the <a href="https://www.gnu.org/licenses/gpl-3.0.en.html">GNU GPLv3 License</a>. The source code is hosted <a href="https://github.com/Maimas2/MyWebsite/tree/master/mun">here</a>.</p>
                <br>
                <p>This website uses <a href="https://jquery.com/">jQuery</a>; <a href="https://github.com/SortableJS/Sortable">SortableJS</a> for the sortable lists; and <a href="https://github.com/SortableJS/jquery-sortablejs">jQuery-Sortable</a> for jQuery bindings.</p>

                <hr>

                <p id="enableManualSorting">Motions aren't sorting automatically? Click <button id="enableMotionSorting">here</button> to allow manually sorting them.</p>
                <p id="disableManualSorting" style="display: none;">Motions are currently only sorted by hand. Click <button id="disableMotionSorting">here</button> to disallow manually sorting them.</p>
            </div>
            <div id="impromptuTimer" class="bottomMarginChildren outlineddiv largePopup">
                <h1 id="impromptuStaticLabel">Timer</h1>
                <input type="text" value="1:00" id="impromptuTimerLabel"></input>
                <div id="impromptuTimerControls">
                    <button id="impromptuTimerStartStop">Start</button>
                    <button id="impromptuTimerReset">Reset</button>
                </div>
            </div>
            <div id="quickStartPopup" class="bottomMarginChildren outlineddiv largePopup">
                <h1>Quick Start</h1>
                <div style="display:inline-block;width:50%;background-color: black;height:1px !important;"></div>
                <p>Load a preset</p>
                <select id="presetSelect">
                    <option disabled>-- choose a preset --</option>
                    <option>General Assembly</option>
                    <option>Security Council</option>
                    <option>G20</option>
                    <option>European Union</option>
                    <option>ASEAN</option>
                </select>
                <br>
                <button id="loadPreset">Load</button>
                <br>
                <div style="display:inline-block;width:50%;background-color: black;height:1px !important;"></div>
                <h2 style="margin:0;">Or make your own</h2>
                <p>Choose which countries are slated to be in your committee</p>
                <button onclick="
                hidePopup(function() {
                    isInQuickStart = true;
                    $('#editdelegatelistbutton').click();
                    $('#quickStartAttendance').prop('disabled', false);
                })
                " id="quickStartDelegates">Do that</button>
                <br><div style="display:inline-block;width:50%;background-color: black;height:1px !important;"></div><br>
                <p>Take attendance</p>
                <button onclick="
                hidePopup(function() {
                    $('#takeAttendanceButton').click();
                })
                " id="quickStartAttendance">Do that</button>
                <br><div style="display:inline-block;width:90%;background-color: black;height:1px !important;"></div>
                <h2>Other Pages</h2>
                <a href="mirror">
                    <button>Mirror a screen</button>
                </a>
                <br>
                <a href="clock">
                    <button>Display a clock</button>
                </a>
                <br>
                <a href="chat">
                    <button>Join a room's chat</button>
                </a>
                <br>
                <br>
                <br>
            </div>
            <div id="joinJccPopup" class="bottomMarginChildren outlineddiv">
                <h1>Join a Joint Crisis Committee</h1>
                <br>
                Name: <input type="text" id="newJccName">
                <br>
                Password: <input type="text" id="newJccPassword">
                <br>
                <button id="newJCC">New JCC</button>
                <button id="joinJCC">Join existing JCC</button>
            </div>
            <div id="jccInfoPopup" class="bottomMarginChildren outlineddiv largePopup">
                <h1>JCC Name: <span id="jccNameSpan"></span></h1>
                <br>
                <input type="text" id="jccSendMessageInput">
                <button id="jccSendMessageButton">Send</button>
            </div>
            <div id="mirrorSetupPopup" class="bottomMarginChildren outlineddiv largePopup">
                <div id="mirrorFirstStep">
                    <h1>Setup Screen Mirroring</h1>
                    <br>
                    Name: <input type="text" id="mirroringName">
                    <br>
                    Password: <input type="text" id="mirroringPassword">
                    <br>
                    <button id="startMirroringButton">Join</button>
                </div>
                <div id="mirrorSecondStep">
                    <h1>Searching for screens to mirror...</h1>

                    <p>Note: if the control screen disconnects for whatever reason and they need to sign back into the JCC, you will need to refresh this site as well.</p>

                    <br>

                    <div id="listOfMirrorables">

                    </div>
                </div>
            </div>
            <div id="exitButtons">
                <button id="quitPopup" onclick="quitPopup()">Discard</button>
                <button id="exitPopup">Submit</button>
            </div>
        </div>
        <div id="prefabs" style="display: none !important;">
            <div id="attendanceButtonsPrefab">
                <p style="display: inline-block;width:300px;"></p>
                <button onclick="firstAttendanceClick(this)">Ab</button>
                <button onclick="secondAttendanceClick(this)">Pr</button>
                <button onclick="thirdAttendanceClick(this)">Pr&V</button>
                <br>
                <div style="display:inline-block;width:50%;background-color: black;height:1px !important;"></div>
            </div>
            <div id="modMotionPrefab" class="outlineddiv innermotiondisplay startClear" data-motiontype="mod">
                <div>
                    <h1 style="padding-right: 20px;display:inline;">Moderated Caucus</h1>
                    <div>
                        <button onclick="passMotion(this.parentNode.parentNode.parentNode)" style="margin-right: 20px;">Motion Passed</button>
                        <button onclick="killMotionDisplay(this);" style="margin-right: 20px;">Motion Failed</button>
                    </div>
                </div>
                <div class="middleLine"></div>
                <div class="zoomInALittle">
                    <b>Topic:</b> <input style="text-align: left; width:70%;" type="text" value="">
                    <br>
                    <b>Total duration:</b> <input type="text" value="5:00" class="largeTextInput">
                    <br>
                    <b>Delegate speaking time:</b> <input type="text" value="1:00" class="largeTextInput">
                </div>
            </div>
            <div id="speakersListMotionPrefab" class="outlineddiv innermotiondisplay startClear" data-motiontype="speakersList">
                <div>
                    <h1 style="padding-right: 20px;display:inline;">Open the Speakers List</h1>
                    <div>
                        <button onclick="passMotion(this.parentNode.parentNode.parentNode)" style="margin-right: 20px;">Motion Passed</button>
                        <button onclick="killMotionDisplay(this);" style="margin-right: 20px;">Motion Failed</button>
                    </div>
                </div>
                <div class="middleLine"></div>
                <div class="zoomInALittle">
                    <b>Number of Speakers:</b> <input type="text" value="10" class="largeTextInput">
                    <br>
                    <b>Delegate speaking time:</b> <input type="text" value="1:00" class="largeTextInput">
                </div>
            </div>
            <div id="unmodMotionPrefab" class="outlineddiv innermotiondisplay startClear" data-motiontype="unmod">
                <div>
                    <h1 style="display:inline;padding-right: 20px;">Unmoderated Caucus</h1>
                    <div>
                        <button onclick="passMotion(this.parentNode.parentNode.parentNode)" style="margin-right: 20px;">Motion Passed</button>
                        <button onclick="killMotionDisplay(this);" style="margin-right: 20px;">Motion Failed</button>
                    </div>
                </div>
                <div class="middleLine"></div>
                <div class="zoomInALittle">
                    <b>Topic:</b> <input style="text-align: left; width: 70%;" type="text" value="">
                    <br>
                    <b>Duration:</b> <input type="text" value="5:00" class="largeTextInput">
                </div>
            </div>
            <div id="roundRobinMotionPrefab" class="outlineddiv innermotiondisplay startClear" data-motiontype="roundRobin">
                <div>
                    <h1 style="padding-right: 20px;display:inline;">Round Robin</h1>
                    <div>
                        <button onclick="passMotion(this.parentNode.parentNode.parentNode)" style="margin-right: 20px;">Motion Passed</button>
                        <button onclick="killMotionDisplay(this);" style="margin-right: 20px;">Motion Failed</button>
                    </div>
                </div>
                <div class="middleLine"></div>
                <div class="zoomInALittle">
                    <b>Topic:</b> <input type="text" value="" class="largeTextInput" style="width: 70%; text-align: left !important;">
                    <br>
                    <b>Delegate speaking time:</b> <input type="text" value="0:15" class="largeTextInput">
                </div>
            </div>
            <div id="presentPapersMotionPrefab" class="outlineddiv innermotiondisplay startClear" data-motiontype="presentPapers">
                <div>
                    <h1 style="padding-right: 20px;display:inline;">Present Papers</h1>
                    <div>
                        <button onclick="parsePassedMotionJSON(introducePapersJSONConfig);" style="margin-right: 20px;">Motion Passed</button>
                        <button onclick="killMotionDisplay(this);">Motion Failed</button>
                    </div>
                </div>
                <div class="middleLine"></div>
                <div class="zoomInALittle">
                    
                </div>
            </div>
            <div id="dividerLinePrefab" style="display:inline-block;width:50%;background-color: black;height:1px !important;"></div>
        </div>
        <div id="alertContainer" class="outlineddiv" onclick="clearInterval(hidingAlertInterval);$(this).animate({opacity: 0}, 150);hidingAlertInterval=setInterval(((_e) => {this.style.display = 'none';clearInterval(hidingAlertInterval);}), 150)">
            <p id="alertText" style="width: 100%;text-align: center;">This is really really bad</p>
            <div>
                <button style="margin: auto;" onclick="this.parentNode.parentNode.click();">Dismiss</button>
            </div>
            <button id="alertOtherOption" style="white-space:nowrap;">
                Do that
            </button>
        </div>
        <div id="floatBottomRight">
            <button id="commenceRollCall" class="outlineddiv">
                Roll Call Vote<span class="keyboardShortcut"> (v)</span>
            </button>
            <button id="impromptuTimerButton">
                Timer<span class="keyboardShortcut"> (t)</span>
            </button>
        </div>
        <div id="hiddenChosenCountries" style="display: none !important;">
            
        </div>
        <div id="backgroundLogoContainer">
            <img src="/UN-logo.png" id="backgroundLogo">
        </div>
    </body>
    <script src="/worker.js"></script>
</html>